@using SOCAUD.Intranet.Models;

@model ParametroModel
 
@{
    ViewBag.PageTitle = "Parametros";
    ViewBag.PageDescription = "Parametros";
    ViewBag.PageDescription = "Parametros del Sistema";
}
 
    <div class="box box-primary color-palette-box">
        <div class="box-header with-border">
            <h3 class="box-title">Parametros del Sistema</h3>
        </div>
        <div class="box-body">

            <div class="form-group">
                <div class="row">
                    <div class="col-md-6">
                        @Html.LabelFor(m => m.CODTIPPAR)
                        @Html.DropDownListFor(c=>c.CODTIPPAR, Model.cboListaTipoParametro, "Seleccione", new { @class = "form-control" })
                        @Html.ValidationMessageFor(c => c.CODTIPPAR)
                    </div>
                    <div class="col-md-6">
                        <br />
                        <button type="button" id="btnBuscar" class="btn btn-primary">Buscar</button>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="row">
                    <div class="col-md-12">
                        <table id="tabParametros" name="tabPerfil" class="table table-striped table-bordered" cellpadding="0" cellspacing="0" border="0"></table>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="row">
                    <div class="col-md-12" style="text-align:center;">
                        <button id="btnAgregarNuevo" type="button" class="btn btn-success"><i class="fa fa-save"></i>&nbsp;Agregar Nuevo</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


@section scripts {

    <script type="text/ecmascript">
        
        $(document).ready(function () {
            listarParametros();
            $("#btnAgregarNuevo").click(function () {
                document.location.href = '@Url.Action("AgregarParametro","Parametro")';
            });
            $("#btnBuscar").click(function () {
                var coditoTipo = $("#CODTIPPAR").val();
                debugger;
                listarParametros(coditoTipo);
            });
        });

        var _dataParametro_ = null;
        var tabParametros = $("#tabParametros").dataTable({
            "info": false,
            "bServerSide": false,
            "data": _dataParametro_,
            "order": [[1, "asc"]],
            "columns": [
                {
                    "bSortable": false,
                    "sClass": "center",
                    "sWidth": "5%",
                    "render": function (data, type, row) {
                        return '<center><button class="btn btn-success" title="Editar" type="button" onclick="EditarParametro(' + row[0] + ');"><i class="fa fa-pencil"></i></button></center>';

                    }
                },
                { "sTitle": "Tipo Parametro" },
                { "sTitle": "Nombre" },
                { "sTitle": "Valor" },
                {
                    "bSortable": false,
                    "sClass": "center",
                    "sWidth": "5%",
                    "render": function (data, type, row) {
                        return '<center><button class="btn btn-danger" title="Eliminar" type="button" onclick="EliminarParametro(' + row[0] + ');"><i class="fa fa-trash"></i></button></center>';

                    }
                }
            ]
        });


        function listarParametros(idTipoParam) {
            $.ajax({
                url: '@Url.Action("ListarParametros", "Parametro")',
                type: 'POST',
                async: false,
                data: { idTipo : idTipoParam},
                success: function (result) {
                    _dataParametro_ = result;
                    tabParametros.fnReloadData(_dataParametro_);
                }
            });
        }

        function EliminarParametro(IdPar) {

            bootbox.confirm(parametros.general.mensajeConfirmacion, function (result) {

                if (result) {
                    $.ajax({
                        url: '@Url.Action("EliminarParametro", "Parametro")',
                        type: 'POST',
                        async: false,
                        data: { id: IdPar },
                        success: function (result) {
                            mostrarNotificacion(result);
                            listarParametros();
                        }
                    });
                }
            });


        }

        function EditarParametro(id) {
            document.location.href = '@Url.Action("EditarParametro","Parametro")' + "/" + id;
        }

    </script>
}